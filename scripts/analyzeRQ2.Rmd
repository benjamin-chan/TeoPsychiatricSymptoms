# Research Question 2

Are certains features of social media use are associated with positive screens for psychiatric disorders or a positive screen for suicidality?

* Spending more time on Facebook?
  * Frequency of Facebook use: `fb_freq`
  * Active use of Facebook: `comm_facebook`
* Sharing more personal or health-related information on social media?
  * `sm_emot_support`
  * `sm_med_info`
  * `sm_med_advice`
  * `sm_med_questions`
  * `sm_share_symptoms`
  * `sm_share_health`
  * `sm_share_suicide`
  
  
## Association between frequency of Facebook use and active use of Facebook

Correlation (Spearman) between frequency of Facebook use and active use of Facebook is
`r df0 %>% select(fb_freq, comm_facebook) %>% mutate(fb_freq = unclass(fb_freq), comm_facebook = unclass(comm_facebook)) %>% na.omit() %>% cor(method = "spearman") %>% .[1, 2] %>% sprintf("%.03f", .)`


## Unadjusted comparisons

```{r, eval = FALSE}
align <- "llccc"
digits <- c(0, 0, 0, 0, 3)
df0 %>% freq2Group("fb_freq", "indPTSD") %>% kable(align = align, digits = digits)
df0 %>% freq2Group("comm_facebook", "indPTSD") %>% kable(align = align, digits = digits)
df0 %>% freq2Group("fb_freq", "indPHQ") %>% kable(align = align, digits = digits)
df0 %>% freq2Group("comm_facebook", "indPHQ") %>% kable(align = align, digits = digits)
df0 %>% freq2Group("fb_freq", "indAuditC") %>% kable(align = align, digits = digits)
df0 %>% freq2Group("comm_facebook", "indAuditC") %>% kable(align = align, digits = digits)
df0 %>% freq2Group("fb_freq", "indDSISS") %>% kable(align = align, digits = digits)
df0 %>% freq2Group("comm_facebook", "indDSISS") %>% kable(align = align, digits = digits)
```

```{r plot2GroupsRQ2}
df0 %>% 
  select(record_id, fb_freq, indPTSD, indPHQ, indAuditC, indDSISS) %>% 
  gather(key = variable, value = value, -record_id, -fb_freq) %>% 
  filter(!is.na(value) & !is.na(fb_freq)) %>% 
  mutate(variable = case_when(variable == "indPTSD" ~ "PC-PTSD",
                              variable == "indPHQ" ~ "PHQ-2",
                              variable == "indAuditC" ~ "AUDIT-C",
                              variable == "indDSISS" ~ "DSI-SS")) %>% 
  mutate(variable = factor(variable, levels = c("PC-PTSD", "PHQ-2", "AUDIT-C", "DSI-SS"))) %>% 
  mutate(value = factor(value, levels = c(FALSE, TRUE), labels = c("Negative", "Positive"))) %>% 
  mutate(fb_freq = factor(fb_freq)) %>% 
  ggplot() +
  ggtitle("Frequency of Facebook use") +
  aes(x = fb_freq, color = value, fill = value) +
  geom_bar(data = . %>% filter(value == "Negative"), aes(y = ..count.. * (-1)), alpha = 1/1) +
  geom_bar(data = . %>% filter(value == "Positive"), alpha = 1/1) +
  scale_x_discrete("") +
  scale_y_continuous("Count", breaks = seq(-300, 300, 100), labels = abs(seq(-300, 300, 100))) +
  scale_color_brewer("Screened", palette = "Set1") + 
  scale_fill_brewer("Screened", palette = "Set1") + 
  facet_wrap(~ variable) +
  coord_flip() +
  theme(plot.title = element_text(hjust = 0.5))
df0 %>% 
  select(record_id, comm_facebook, indPTSD, indPHQ, indAuditC, indDSISS) %>%
  gather(key = variable, value = value, -record_id, -comm_facebook) %>% 
  filter(!is.na(value) & !is.na(comm_facebook)) %>% 
  mutate(variable = case_when(variable == "indPTSD" ~ "PC-PTSD",
                              variable == "indPHQ" ~ "PHQ-2",
                              variable == "indAuditC" ~ "AUDIT-C",
                              variable == "indDSISS" ~ "DSI-SS")) %>% 
  mutate(variable = factor(variable, levels = c("PC-PTSD", "PHQ-2", "AUDIT-C", "DSI-SS"))) %>% 
  mutate(value = factor(value, levels = c(FALSE, TRUE), labels = c("Negative", "Positive"))) %>% 
  mutate(comm_facebook = factor(comm_facebook)) %>% 
  ggplot() +
  ggtitle("Active use of Facebook") +
  aes(x = comm_facebook, color = value, fill = value) +
  geom_bar(data = . %>% filter(value == "Negative"), aes(y = ..count.. * (-1)), alpha = 1/1) +
  geom_bar(data = . %>% filter(value == "Positive"), alpha = 1/1) +
  scale_x_discrete("") +
  scale_y_continuous("Count", breaks = seq(-300, 300, 100), labels = abs(seq(-300, 300, 100))) +
  scale_color_brewer("Screened", palette = "Set1") + 
  scale_fill_brewer("Screened", palette = "Set1") + 
  facet_wrap(~ variable) +
  coord_flip() +
  theme(plot.title = element_text(hjust = 0.5))
```


## Adjusted comparisons

```{r}
covar <- c("countSocialMediaExclFB",
           "comm_inperson",
           "indSuicideConsideredEver",
           "countSuicideAttempts")
```

Filter subjects with missing covariates.

```{r}
df2 <-
  df0 %>% 
  select_(.dots = c("record_id", covar)) %>% 
  na.omit() %>% 
  select(record_id) %>% 
  merge(., df0, by = "record_id")
```

Relabel factors; replace spaces with underscores.

```{r}
df2 <-
  df2 %>% 
  mutate(fb_freq = factor(fb_freq, labels = gsub(" ", "_", levels(.$fb_freq))),
         comm_facebook = factor(comm_facebook, labels = gsub(" ", "_", levels(.$comm_facebook))))
```

Define linear function for general hypothesis testing.

```{r}
linfct1 <- sprintf("fb_freq%s = 0", levels(df2$fb_freq))[-1]
linfct2 <- sprintf("comm_facebook%s = 0", levels(df2$comm_facebook))[-1]
```


### PC-PTSD vs Frequency of Facebook use

```{r}
modelTables <- wrapperRQ2(df2, "indPTSD", "fb_freq", covar, linfct1)
modelTables[["Ftests"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["oddsratios"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["fit"]] %>% kable(digits = 3)
```


### PC-PTSD vs Active use of Facebook

```{r}
modelTables <- wrapperRQ2(df2, "indPTSD", "comm_facebook", covar, linfct2)
modelTables[["Ftests"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["oddsratios"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["fit"]] %>% kable(digits = 3)
```


### PHQ-2 vs Frequency of Facebook use

```{r}
modelTables <- wrapperRQ2(df2, "indPHQ", "fb_freq", covar, linfct1)
modelTables[["Ftests"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["oddsratios"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["fit"]] %>% kable(digits = 3)
```


### PHQ-2 vs Active use of Facebook

```{r}
modelTables <- wrapperRQ2(df2, "indPHQ", "comm_facebook", covar, linfct2)
modelTables[["Ftests"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["oddsratios"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["fit"]] %>% kable(digits = 3)
```


### AUDIT-C vs Frequency of Facebook use

```{r}
modelTables <- wrapperRQ2(df2, "indAuditC", "fb_freq", covar, linfct1)
modelTables[["Ftests"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["oddsratios"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["fit"]] %>% kable(digits = 3)
```


### AUDIT-C vs Active use of Facebook

```{r}
modelTables <- wrapperRQ2(df2, "indAuditC", "comm_facebook", covar, linfct2)
modelTables[["Ftests"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["oddsratios"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["fit"]] %>% kable(digits = 3)
```


### DSI-SS vs Frequency of Facebook use

```{r}
modelTables <- wrapperRQ2(df2, "indDSISS", "fb_freq", covar, linfct1)
modelTables[["Ftests"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["oddsratios"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["fit"]] %>% kable(digits = 3)
```


### DSI-SS vs Active use of Facebook

```{r}
modelTables <- wrapperRQ2(df2, "indDSISS", "comm_facebook", covar, linfct2)
modelTables[["Ftests"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["oddsratios"]] %>% kable(digits = 3)
```

\newline

```{r}
modelTables[["fit"]] %>% kable(digits = 3)
```
